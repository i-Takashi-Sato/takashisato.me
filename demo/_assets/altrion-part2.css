@import url("https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;700&family=Inter:wght@200;300;400;500&family=Cormorant+Garamond:ital,wght@0,300;0,400;1,400&display=swap");

:root{
  --phi: 1.61803398875;

  --bg:#050507;
  --marble:#f2f2f2;
  --gold:#D4AF37;
  --crimson:#8A0303;

  --rule: rgba(255,255,255,.08);
  --panelA: rgba(10,10,14,.90);

  --uiE: 0;
  --uiDim: 0;
  --uiBlur: 0;
  --uiSkew: 0;
  --uiNoise: 0;
  --uiScan: 0;
  --uiRuleBoost: 0;
  --uiGoldMute: 0;
  --uiLetter: 0;
  --uiFlicker: 0;

  --stamp: 0;
  --stampRot: 0deg;

  --gate0: 1;
  --gate1: 0;
  --gate2: 0;
  --gate3: 0;

  --hudGlow: 0;
  --ink: rgba(240,240,248,.82);
  --inkDim: rgba(210,210,220,.38);
}

html,body{height:100%;}
*{box-sizing:border-box;}

body{
  margin:0;
  background:
    radial-gradient(1200px 900px at 74% 26%, rgba(212,175,55,.14), rgba(0,0,0,0) 58%),
    radial-gradient(900px 700px at 28% 74%, rgba(138,3,3,.12), rgba(0,0,0,0) 56%),
    radial-gradient(1200px 900px at 70% 58%, rgba(255,255,255,.06), rgba(0,0,0,0) 62%),
    var(--bg);
  color: var(--marble);
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  overflow:hidden;
  width:100vw;
  height:100vh;
}
/* --- Scene Mount (renderer.domElement) --- */
body > canvas{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  display:block;
  z-index:0;
  transform: translate3d(var(--sceneShiftX),0,0);
  transform-origin: 50% 50%;
}

/* Allow UI to remain usable on small viewports */
.panel-glass{
  max-height: 100dvh;
  overflow:auto;
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
  padding-bottom: max(calc(10vh / var(--phi)), env(safe-area-inset-bottom));
}

/* Dynamic viewport stability */
body{
  height:100dvh;
}

/* Desktop: place the figure slightly to the right (avoid over-centering) */
:root{ --sceneShiftX: 6.2vw; }

@media (max-width: 1024px){
  :root{ --sceneShiftX: 0vw; }
}


canvas{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  display:block;
  filter: brightness(1.18) contrast(1.08) saturate(1.10);
  transform: translateZ(0);
}

body::before{
  content:"";
  position:fixed;
  inset:-60px;
  pointer-events:none;
  z-index:6;
  opacity: calc(0.03 + var(--uiNoise) * 0.16);
  background:
    repeating-linear-gradient(
      180deg,
      rgba(255,255,255,0.00) 0px,
      rgba(255,255,255,0.00) 2px,
      rgba(255,255,255,0.018) 3px,
      rgba(255,255,255,0.00) 7px
    ),
    repeating-linear-gradient(
      90deg,
      rgba(255,255,255,0.00) 0px,
      rgba(255,255,255,0.00) 18px,
      rgba(255,255,255,0.016) 19px,
      rgba(255,255,255,0.00) 28px
    ),
    radial-gradient(1200px 900px at 44% 28%, rgba(255,255,255,0.028), rgba(0,0,0,0) 60%),
    radial-gradient(900px 700px at 76% 82%, rgba(212,175,55,0.020), rgba(0,0,0,0) 56%);
  filter: blur(calc(0.30px + var(--uiNoise) * 1.05px));
  mix-blend-mode: soft-light;
  transform: translate3d(0,0,0);
}

body::after{
  content:"";
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:7;
  opacity: calc(var(--uiScan) * 0.22);
  background:
    radial-gradient(1200px 900px at 70% 56%, rgba(255,255,255,0.028), rgba(0,0,0,0) 60%),
    linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(255,255,255,0.055) 48%, rgba(0,0,0,0) 100%);
  transform: translateY(calc(sin(var(--uiFlicker) * 1rad) * 1.0px));
  mix-blend-mode: overlay;
}

#interface{
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:10;
  display:grid;
  grid-template-columns: 38.2vw 61.8vw;
}

.panel-glass{
  pointer-events:auto;
  position:relative;
  border-right:1px solid rgba(255,255,255, calc(0.10 + var(--uiRuleBoost) * 0.18));
  padding: calc(10vh / var(--phi)) calc(10vw / var(--phi));
  display:flex;
  flex-direction:column;
  justify-content:center;
  transform: skewX(calc(var(--uiSkew) * -0.32deg));
  will-change: filter, transform;
  isolation:isolate;

  background:
    radial-gradient(1200px 900px at 12% 40%, rgba(255,255,255,.06), rgba(0,0,0,0) 58%),
    radial-gradient(circle at 0% 50%, rgba(14,14,18,.92) 0%, rgba(8,8,12,.72) 22%, rgba(0,0,0,0) 72%),
    linear-gradient(90deg, rgba(0,0,0,.46), rgba(0,0,0,0));

  filter:
    blur(calc(var(--uiBlur) * 0.50px))
    contrast(calc(1.0 - var(--uiDim) * 0.06))
    saturate(calc(1.0 - var(--uiDim) * 0.08));
}

.panel-glass::before{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:-1;
  opacity: calc(0.52 - var(--uiDim) * 0.10);
  background:
    radial-gradient(900px 700px at 18% 20%, rgba(255,255,255,.12), rgba(0,0,0,0) 48%),
    radial-gradient(900px 700px at 26% 78%, rgba(212,175,55,.07), rgba(0,0,0,0) 56%),
    radial-gradient(900px 700px at 12% 52%, rgba(138,3,3,.06), rgba(0,0,0,0) 56%);
  mix-blend-mode: screen;
  filter: blur(18px);
  transform: translateZ(0);
}

.panel-glass::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:2;
  opacity: calc(0.65 - var(--uiDim) * 0.20);
  background:
    linear-gradient(135deg, rgba(255,255,255,.16), rgba(0,0,0,0) 38%),
    linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,0) 32%),
    linear-gradient(90deg, rgba(255,255,255,.10), rgba(0,0,0,0) 24%),
    radial-gradient(1200px 900px at 14% 46%, rgba(255,255,255,.09), rgba(0,0,0,0) 62%);
  mix-blend-mode: overlay;
  filter: blur(0.6px);
  transform: translateZ(0);
}

@supports ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))){
  .panel-glass{
    background:
      radial-gradient(circle at 0% 50%, rgba(14,14,18,.62) 0%, rgba(8,8,12,.36) 26%, rgba(0,0,0,0) 72%),
      linear-gradient(90deg, rgba(0,0,0,.22), rgba(0,0,0,0));
    -webkit-backdrop-filter: blur(18px) saturate(1.12) contrast(1.02);
    backdrop-filter: blur(18px) saturate(1.12) contrast(1.02);
  }
}

.panel-inner{position:relative;transform: translate3d(0,0,0);}

.panel-inner::before{
  content:"";
  position:absolute;
  inset:-18px;
  pointer-events:none;
  z-index:1;
  opacity: calc(var(--uiNoise) * 0.10);
  background:
    repeating-linear-gradient(
      90deg,
      rgba(255,255,255,0.00) 0px,
      rgba(255,255,255,0.00) 14px,
      rgba(255,255,255,0.018) 15px,
      rgba(255,255,255,0.00) 22px
    );
  mix-blend-mode: overlay;
  filter: blur(0.30px);
}

.panel-inner::after{
  content:"";
  position:absolute;
  inset:-22px;
  pointer-events:none;
  z-index:1;
  opacity: calc(0.0 + var(--uiDim) * 0.08);
  background:
    linear-gradient(180deg, rgba(255,255,255,0.014), rgba(0,0,0,0) 42%),
    radial-gradient(900px 700px at 10% 60%, rgba(138,3,3,0.022), rgba(0,0,0,0) 60%);
  mix-blend-mode: soft-light;
  filter: blur(0.55px);
}

.kicker{
  font-size:.62rem;
  letter-spacing:.42em;
  color: rgba(212,175,55, calc(.94 - var(--uiGoldMute) * 0.50));
  opacity: calc(.92 - var(--uiDim) * 0.16);
  text-transform:uppercase;
  margin: 0 0 calc(.75rem * var(--phi)) 0;
  display:flex;
  align-items:center;
  gap:.75rem;
}

.kicker .dot{
  width:6px;
  height:6px;
  border-radius:50%;
  background: rgba(212,175,55, calc(.90 - var(--uiGoldMute) * 0.50));
  box-shadow: 0 0 16px rgba(212,175,55, calc(.22 + var(--hudGlow) * 0.25));
  opacity: calc(.88 - var(--uiDim) * 0.10);
}

h1{
  font-family: Cinzel, serif;
  font-weight: 400;
  font-size: clamp(2.1rem, 4.6vw, 4.2rem);
  line-height: .9;
  margin: 0 0 calc(1rem * var(--phi)) 0;
  color:#fff;
  letter-spacing: calc(.02em + var(--uiLetter) * 0.080em);
  text-transform:uppercase;
  text-shadow:
    0 0 40px rgba(255,255,255,.22),
    0 0 110px rgba(212,175,55,.14);
  mix-blend-mode: hard-light;
  opacity: calc(1.0 - var(--uiDim) * 0.08);
}

.subtitle{
  font-family: "Cormorant Garamond", serif;
  font-style: italic;
  font-size: clamp(.95rem, 1.1vw, 1.25rem);
  color: rgba(212,175,55, calc(.94 - var(--uiGoldMute) * 0.48));
  margin-bottom: calc(1.55rem * var(--phi));
  letter-spacing: calc(.12em + var(--uiLetter) * 0.06em);
  opacity: calc(.94 - var(--uiDim) * 0.16);
  border-left:2px solid rgba(212,175,55, calc(1.0 - var(--uiGoldMute) * 0.54));
  padding-left: calc(1rem * var(--phi));
}

.assertion{
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  font-size:.78rem;
  font-weight:300;
  line-height:1.55;
  color: rgba(238,238,244, calc(.86 - var(--uiDim) * 0.12));
  letter-spacing: calc(.10em + var(--uiLetter) * 0.05em);
  text-transform:uppercase;
  margin: 0 0 calc(2.2rem * var(--phi)) 0;
  opacity: calc(.95 - var(--uiDim) * 0.18);
  position:relative;
  padding-left: 14px;
}

.assertion::before{
  content:"";
  position:absolute;
  left:0;
  top:.55em;
  width:7px;
  height:1px;
  background: rgba(255,255,255, calc(.42 + var(--uiRuleBoost) * 0.26));
  opacity: calc(.78 - var(--uiDim) * 0.10);
}

.gates{
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom: calc(1.7rem * var(--phi));
  padding: 10px 0;
  border-top:1px solid rgba(255,255,255, calc(.08 + var(--uiRuleBoost) * .14));
  border-bottom:1px solid rgba(255,255,255, calc(.08 + var(--uiRuleBoost) * .14));
  opacity: calc(.95 - var(--uiDim) * .14);
}

.gate{
  display:flex;
  align-items:center;
  gap:8px;
  min-width: 0;
}

.gate i{
  width:10px;
  height:10px;
  border-radius:50%;
  display:inline-block;
  background: rgba(255,255,255,.16);
  box-shadow: 0 0 0 1px rgba(255,255,255,.10) inset;
  position:relative;
  overflow:hidden;
}

.gate i::after{
  content:"";
  position:absolute;
  inset:0;
  background: radial-gradient(circle at 35% 35%, rgba(255,255,255,.36), rgba(0,0,0,0) 62%);
  opacity:.58;
}

.gate span{
  font-size:.58rem;
  font-weight:300;
  letter-spacing:.34em;
  text-transform:uppercase;
  color: rgba(210,210,220, calc(.44 - var(--uiDim) * 0.10));
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.gate.g0 i{ background: rgba(212,175,55, calc(.22 + var(--gate0) * .62)); box-shadow: 0 0 16px rgba(212,175,55, calc(.14 + var(--gate0) * .34)); }
.gate.g1 i{ background: rgba(212,175,55, calc(.12 + var(--gate1) * .55)); box-shadow: 0 0 16px rgba(212,175,55, calc(.10 + var(--gate1) * .26)); }
.gate.g2 i{ background: rgba(138,3,3,  calc(.12 + var(--gate2) * .55)); box-shadow: 0 0 18px rgba(138,3,3,  calc(.10 + var(--gate2) * .28)); }
.gate.g3 i{ background: rgba(255,255,255, calc(.10 + var(--gate3) * .42)); box-shadow: 0 0 20px rgba(255,255,255, calc(.08 + var(--gate3) * .22)); }

.trajectory-list{
  display:flex;
  flex-direction:column;
  gap: calc(.8rem * var(--phi));
  margin-bottom: calc(2.3rem * var(--phi));
}

.traj-item{
  font-size:.72rem;
  font-weight:300;
  color: rgba(210,210,220, calc(.40 - var(--uiDim) * 0.08));
  text-transform:uppercase;
  letter-spacing: calc(.15em + var(--uiLetter) * 0.05em);
  transition: all 900ms cubic-bezier(.16,1,.3,1);
  position:relative;
  padding-left: 20px;
  user-select:none;
  text-shadow:none;
  opacity: calc(1.0 - var(--uiDim) * 0.08);
}

.traj-item::before{
  content:"";
  position:absolute;
  left:0;
  top:50%;
  width:2px;
  height:2px;
  background: rgba(212,175,55, calc(.90 - var(--uiGoldMute) * 0.50));
  border-radius:50%;
  transform: translateY(-50%);
  transition: all 520ms cubic-bezier(.16,1,.3,1);
  opacity: calc(.90 - var(--uiDim) * 0.08);
}

.traj-item.active{
  color:#fff;
  text-shadow:
    0 0 18px rgba(212,175,55,.34),
    0 0 60px rgba(255,255,255,.10);
  padding-left: calc(20px * var(--phi));
  opacity: 1;
}

.traj-item.active::before{
  width: 34px;
  height: 1px;
  border-radius:0;
  opacity:1;
}

.phase-container{
  margin-bottom:auto;
  position:relative;
  border-top:1px solid rgba(255,255,255, calc(.10 + var(--uiRuleBoost) * 0.16));
  padding-top: calc(1.5rem * var(--phi));
}

.phase-meta{
  font-size:.62rem;
  color: rgba(212,175,55, calc(.94 - var(--uiGoldMute) * 0.54));
  letter-spacing: calc(.42em + var(--uiLetter) * 0.06em);
  margin-bottom: calc(.5rem * var(--phi));
  opacity: calc(1.0 - var(--uiDim) * 0.16);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}

.phase-meta .badge{
  font-size:.56rem;
  letter-spacing:.42em;
  color: rgba(255,255,255, calc(.40 + var(--uiRuleBoost) * .20));
  opacity: calc(.84 - var(--uiDim) * 0.16);
  text-transform:uppercase;
  border:1px solid rgba(255,255,255, calc(.12 + var(--uiRuleBoost) * .22));
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(0,0,0,.14);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  transform: translateZ(0);
  position:relative;
  overflow:hidden;
}

.phase-meta .badge::before{
  content:"";
  position:absolute;
  inset:-40% -40%;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.12), rgba(0,0,0,0) 55%);
  opacity: calc(.34 + var(--hudGlow) * .26);
  transform: translateZ(0);
  pointer-events:none;
}

.phase-title{
  font-family:Cinzel, serif;
  font-size: calc(1.1rem * var(--phi));
  margin: 0 0 1rem 0;
  color:#fff;
  letter-spacing: calc(.05em + var(--uiLetter) * 0.05em);
  text-shadow: 0 0 20px rgba(255,255,255,.14);
  opacity: calc(1.0 - var(--uiDim) * 0.08);
}

.phase-desc{
  font-family:"Cormorant Garamond", serif;
  font-size: 1.08rem;
  line-height: 1.72;
  color: rgba(238,238,244, calc(.84 - var(--uiDim) * 0.10));
  max-width: 92%;
  text-shadow: 0 0 22px rgba(0,0,0,.28);
}

.audit{
  margin-top: calc(1.35rem * var(--phi));
  border-top: 1px solid rgba(255,255,255, calc(.08 + var(--uiRuleBoost) * .14));
  padding-top: calc(.95rem * var(--phi));
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px 16px;
  opacity: calc(.95 - var(--uiDim) * 0.16);
}

.metric{
  display:flex;
  flex-direction:column;
  gap:4px;
  min-width:0;
  position:relative;
  padding-left: 10px;
}

.metric::before{
  content:"";
  position:absolute;
  left:0;
  top:2px;
  bottom:2px;
  width:1px;
  background: rgba(255,255,255, calc(.12 + var(--uiRuleBoost) * .18));
  opacity: calc(.78 - var(--uiDim) * .10);
}

.metric .k{
  font-size:.56rem;
  font-weight:300;
  letter-spacing:.34em;
  text-transform:uppercase;
  color: rgba(210,210,220, calc(.42 - var(--uiDim) * .10));
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.metric .v{
  font-size:.92rem;
  font-weight:200;
  letter-spacing: .08em;
  color: rgba(255,255,255, calc(.92 - var(--uiDim) * .14));
  text-shadow: 0 0 22px rgba(255,255,255, calc(.06 + var(--hudGlow) * .10));
}

.controls{
  width:100%;
  margin-top: calc(22px * var(--phi));
  opacity: calc(1.0 - var(--uiDim) * 0.08);
  position:relative;
}

.slider-wrap{
  position:relative;
  height:44px;
  display:flex;
  align-items:center;
  user-select:none;
  touch-action: pan-y;
}

.slider-hit{
  position:absolute;
  inset:0;
  border-radius: 14px;
  background: rgba(0,0,0,0);
  cursor: ew-resize;
  z-index:1;
}

input[type="range"]{
  -webkit-appearance:none;
  appearance:none;
  width:100%;
  height:44px;
  background:transparent;
  cursor:pointer;
  z-index:2;
  outline:none;
  touch-action:none;
}

input[type="range"]::-webkit-slider-runnable-track{
  width:100%;
  height:1px;
  background: rgba(255,255,255, calc(.18 + var(--uiRuleBoost) * 0.10));
}

input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance:none;
  height: 14px;
  width: 14px;
  margin-top:-6.5px;
  background: rgba(11,11,16,.92);
  border: 1px solid rgba(212,175,55, calc(1.0 - var(--uiGoldMute) * 0.54));
  transform: rotate(45deg);
  box-shadow:
    0 0 16px rgba(212,175,55, calc(.62 - var(--uiGoldMute) * 0.28)),
    0 0 48px rgba(212,175,55, calc(.22 - var(--uiGoldMute) * 0.10));
  transition: transform .22s ease, background .22s ease;
}

input[type="range"]:hover::-webkit-slider-thumb{
  transform: rotate(225deg) scale(1.30);
  background: rgba(212,175,55, calc(.92 - var(--uiGoldMute) * 0.46));
}

input[type="range"]::-moz-range-track{
  height:1px;
  background: rgba(255,255,255, calc(.18 + var(--uiRuleBoost) * 0.10));
  border:0;
}

input[type="range"]::-moz-range-thumb{
  height:14px;
  width:14px;
  background: rgba(11,11,16,.92);
  border: 1px solid rgba(212,175,55, calc(1.0 - var(--uiGoldMute) * 0.54));
  transform: rotate(45deg);
  box-shadow:
    0 0 16px rgba(212,175,55, calc(.62 - var(--uiGoldMute) * 0.28)),
    0 0 48px rgba(212,175,55, calc(.22 - var(--uiGoldMute) * 0.10));
}

.slider-progress{
  position:absolute;
  left:0;
  top:50%;
  height:1px;
  width:0%;
  margin-top:-0.5px;
  background: rgba(212,175,55, calc(1.0 - var(--uiGoldMute) * 0.54));
  z-index:0;
  pointer-events:none;
  box-shadow:
    0 0 22px rgba(212,175,55, calc(.72 - var(--uiGoldMute) * 0.32)),
    0 0 80px rgba(212,175,55, calc(.22 - var(--uiGoldMute) * 0.10));
}

.stamp{
  position:absolute;
  right: -14px;
  top: 86px;
  width: 180px;
  height: 180px;
  pointer-events:none;
  opacity: calc(var(--stamp) * 0.70);
  transform: rotate(var(--stampRot)) translateZ(0);
  filter: blur(calc(var(--uiBlur) * 0.36px)) saturate(calc(1.0 - var(--uiGoldMute) * 0.30));
  mix-blend-mode: screen;
}

.stamp svg{width:100%;height:100%;display:block;}
.stamp .ring{fill:none;stroke: rgba(138,3,3, calc(.58 + var(--stamp) * .35));stroke-width: 2.2;stroke-dasharray: 2.5 3.5;}
.stamp .inner{fill:none;stroke: rgba(138,3,3, calc(.28 + var(--stamp) * .30));stroke-width: 1.2;}
.stamp .text{fill: rgba(138,3,3, calc(.48 + var(--stamp) * .30));font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;font-size: 9px;letter-spacing: 4px;text-transform:uppercase;}
.stamp .mark{fill: rgba(138,3,3, calc(.42 + var(--stamp) * .32));opacity: calc(.74 + var(--stamp) * .20);}

#loader{
  position:fixed;
  inset:0;
  background:#000;
  z-index:999;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  font-family: Cinzel, serif;
  color: var(--gold);
  letter-spacing:.5em;
  font-size:.72rem;
  transition: opacity 1.35s ease;
  pointer-events:none;
}

.loader-bar{
  width:140px;
  height:1px;
  background:#222;
  margin-top:16px;
  position:relative;
  overflow:hidden;
}

.loader-fill{
  position:absolute;
  inset:0 auto 0 0;
  width:0%;
  background: var(--gold);
  animation: load 2.20s cubic-bezier(.22,1,.36,1) forwards;
  box-shadow: 0 0 18px rgba(212,175,55,.55);
}

@keyframes load{0%{width:0%;}100%{width:100%;}}

@media (prefers-reduced-motion: reduce){
  body::before, body::after{opacity:0;}
  .traj-item{transition:none;}
  input[type="range"]::-webkit-slider-thumb{transition:none;}
  .stamp{display:none;}
  canvas{filter:none;}
}

@media (max-width: 820px){
  #interface{grid-template-columns: 1fr;}
  .panel-glass{border-right:0; padding: max(18px, env(safe-area-inset-top)) 18px max(18px, env(safe-area-inset-bottom)); transform:none;}
  .panel-inner::before{inset:-12px;}
}
