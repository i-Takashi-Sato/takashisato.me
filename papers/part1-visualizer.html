<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="color-scheme" content="dark" />
<title>ALTRION Gate Visualizer — Part I (V1500 · Phi-Calibrated)</title>
<meta name="description" content="Single-file visualizer for Part I: ALTRION 4-gate workflow governance (G1–G4) with explicit Detect/Enforce specs + live evaluation + ADR preview. V1500 museum skin, phi-calibrated." />

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,400&family=Inter:wght@300;400;600&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">

<!-- ✅ moved from inline <style> -->
<link rel="stylesheet" href="../assets/part1-visualizer.css">
</head>

<body>
  <div class="aura" aria-hidden="true"></div>

  <div class="wrap">
    <header class="top">
      <div class="brand">
        <h1>ALTRION Gate Visualizer (Part I)</h1>
        <p>
          Four-gate workflow governance as a <span class="emph">cognitive firewall</span>.
          Left: pipeline + phase transition (NC → ritualization collapse).
          Right: <span class="emph">explicit gate specs (Detect/Enforce) + live evaluation + ADR preview</span>.
        </p>
        <!-- thesis removed -->
      </div>

      <div class="pillrow" aria-hidden="true">
        <div class="pill"><span class="dot" id="dotSys"></span><span id="pillSys">STABLE</span></div>
        <div class="pill"><span>Critical:</span><span id="pillCrit">40% NC</span></div>
        <div class="pill"><span>Mode:</span><span id="pillMode">SIM</span></div>
      </div>
    </header>

    <section class="stage" role="region" aria-label="ALTRION simulation">
      <div class="grid">
        <!-- LEFT: VISUAL -->
        <div class="viz">
          <canvas id="scene" aria-label="Gate pipeline + phase plot"></canvas>
          <div class="overlay">
            <div class="veil" id="veil"></div>
          </div>

          <div class="banner ok" id="banner">
            <div class="label">
              <b>governance regime</b>
              <span id="bannerDesc">Region of productive friction (oversight remains substantive).</span>
            </div>
            <div class="state">
              <span class="badge"><span class="dot" id="dotReg"></span><span id="bannerState">PRODUCTIVE</span></span>
              <span id="bannerReadout">NC: 12% · Error: 6%</span>
            </div>
          </div>
        </div>

        <!-- RIGHT: CONTROLS / GATES / ADR -->
        <aside class="panel" aria-label="Controls and gate specs">
          <div class="block">
            <div class="hd">
              <b>controls</b>
              <span>single file · CSP-friendly</span>
            </div>
            <div class="bd">
              <div class="controls">
                <div class="row">
                  <label>
                    Institutional condition

                    <!-- Custom combobox (↑↓/Enter + 0.12s popover expand) -->
                    <div class="combo" id="presetCombo" data-value="steady">
                      <button
                        class="comboBtn"
                        id="presetBtn"
                        type="button"
                        role="combobox"
                        aria-haspopup="listbox"
                        aria-expanded="false"
                        aria-controls="presetList"
                        aria-label="Institutional condition"
                      >
                        <span class="comboLabel" id="presetLabelText">Steady (moderate workload)</span>
                        <span class="comboChevron" aria-hidden="true"></span>
                      </button>

                      <div
                        class="comboList"
                        id="presetList"
                        role="listbox"
                        tabindex="-1"
                        aria-label="Institutional condition options"
                        aria-activedescendant=""
                      >
                        <button class="comboOpt" id="presetOpt0" type="button" role="option" data-value="steady" aria-selected="true">
                          Steady (moderate workload)
                        </button>
                        <button class="comboOpt" id="presetOpt1" type="button" role="option" data-value="high" aria-selected="false">
                          High-volume (queue pressure)
                        </button>
                        <button class="comboOpt" id="presetOpt2" type="button" role="option" data-value="strained" aria-selected="false">
                          Strained (thin staffing)
                        </button>
                      </div>
                    </div>
                  </label>

                  <label>
                    Playback
                    <button id="toggle" class="primary" type="button">Pause</button>
                  </label>
                </div>

                <div class="row">
                  <label>
                    Fatigue coefficient (γ)
                    <input id="gamma" type="range" min="10" max="90" value="50" />
                  </label>
                  <label>
                    Workload (λ)
                    <input id="work" type="range" min="0" max="100" value="55" />
                  </label>
                </div>

                <div class="row">
                  <label>
                    Gate friction (time/attention)
                    <input id="friction" type="range" min="0" max="100" value="62" />
                  </label>
                  <label>
                    Re-arm
                    <button id="reset" type="button">Reset / Re-seed</button>
                  </label>
                </div>

                <label>
                  Note
                  <div class="note">
                    <b>Interpretation</b><br/>
                    <code>NC</code> = Institutional non-compliance (overrides/ignores under fatigue).<br/>
                    Below critical NC, staged gates reduce error. Beyond the critical region, Gate 4 becomes procedural
                    (<code>ritualization</code>) and error rises sharply.
                  </div>
                </label>
              </div>
            </div>
          </div>

          <div class="block">
            <div class="hd">
              <b>gate specifications</b>
              <span id="telMeta">live</span>
            </div>
            <div class="bd">
              <div class="subgrid">
                <div class="gatecards" aria-label="G1 to G4 definitions">
                  <!-- G1 -->
                  <div class="gate" id="gate1">
                    <div class="gTop">
                      <div class="gTitle">
                        <b>G1</b><span>Baseline Constraints</span>
                      </div>
                      <div class="gBadges">
                        <span class="badgeMini" id="g1Badge"><span class="dot" id="g1Dot"></span><span id="g1State">PASS</span></span>
                        <span class="badgeMini ok" id="g1Rate">rej 0.0%</span>
                      </div>
                    </div>
                    <div class="gBody">
                      <div class="kv">
                        <div class="k">Detect</div>
                        <div class="v">Non-negotiable constraints <code>C</code> breach (policy/legal/safety baseline).</div>
                      </div>
                      <div class="kv">
                        <div class="k">Enforce</div>
                        <div class="v"><code>REJECT</code> (hard stop). No human “exception” without explicit override channel.</div>
                      </div>
                    </div>
                  </div>

                  <!-- G2 -->
                  <div class="gate" id="gate2">
                    <div class="gTop">
                      <div class="gTitle">
                        <b>G2</b><span>Value Conflict</span>
                      </div>
                      <div class="gBadges">
                        <span class="badgeMini" id="g2Badge"><span class="dot" id="g2Dot"></span><span id="g2State">CLEAR</span></span>
                        <span class="badgeMini ok" id="g2Rate">warn 0.0%</span>
                      </div>
                    </div>
                    <div class="gBody">
                      <div class="kv">
                        <div class="k">Detect</div>
                        <div class="v">Optimization tension: primary gain <code>ΔM&gt;0</code> while a proxy/secondary degrades <code>Δp&lt;−θ</code>.</div>
                      </div>
                      <div class="kv">
                        <div class="k">Enforce</div>
                        <div class="v"><code>FLAG</code> value conflict → escalates to Gate 4 (written rationale required).</div>
                      </div>
                    </div>
                  </div>

                  <!-- G3 -->
                  <div class="gate" id="gate3">
                    <div class="gTop">
                      <div class="gTitle">
                        <b>G3</b><span>Temporal Reliability</span>
                      </div>
                      <div class="gBadges">
                        <span class="badgeMini" id="g3Badge"><span class="dot" id="g3Dot"></span><span id="g3State">FRESH</span></span>
                        <span class="badgeMini ok" id="g3Rate">warn 0.0%</span>
                      </div>
                    </div>
                    <div class="gBody">
                      <div class="kv">
                        <div class="k">Detect</div>
                        <div class="v">Staleness: <code>(t_current − t_data) &gt; τ</code> (context drift / out-of-date basis).</div>
                      </div>
                      <div class="kv">
                        <div class="k">Enforce</div>
                        <div class="v"><code>WARN</code> temporal reliability → escalates to Gate 4 (explicit acknowledgement + rationale).</div>
                      </div>
                    </div>
                  </div>

                  <!-- G4 -->
                  <div class="gate" id="gate4">
                    <div class="gTop">
                      <div class="gTitle">
                        <b>G4</b><span>Human Arbitration</span>
                      </div>
                      <div class="gBadges">
                        <span class="badgeMini" id="g4Badge"><span class="dot" id="g4Dot"></span><span id="g4State">SUBSTANTIVE</span></span>
                        <span class="badgeMini ok" id="g4Req">rationale off</span>
                      </div>
                    </div>
                    <div class="gBody">
                      <div class="kv">
                        <div class="k">Detect</div>
                        <div class="v">Presence of <code>FLAG/WARN</code> from G2/G3; or proximity to critical regime (NC approaching threshold).</div>
                      </div>
                      <div class="kv">
                        <div class="k">Enforce</div>
                        <div class="v"><code>R</code> written rationale required for flagged cases; generate <code>ADR</code> for auditability.
                          In collapse, arbitration degrades to procedure (“ritual”).</div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="split" aria-label="Live evaluation and ADR">
                  <!-- Live case -->
                  <div class="case" aria-label="Live case evaluation">
                    <div class="caseHead">
                      <b>live evaluation</b>
                      <span id="caseId">case: —</span>
                    </div>
                    <div class="caseGrid">
                      <div class="stat">
                        <div class="t">ΔM (primary)</div>
                        <div class="n" id="cDeltaM">—</div>
                      </div>
                      <div class="stat">
                        <div class="t">Δp (proxy)</div>
                        <div class="n" id="cDeltaP">—</div>
                      </div>
                      <div class="stat">
                        <div class="t">staleness</div>
                        <div class="n" id="cAge">—</div>
                      </div>
                      <div class="stat">
                        <div class="t">decision</div>
                        <div class="n" id="cDecision">—</div>
                      </div>
                    </div>
                    <div class="foot">
                      This “case” is a synthetic exemplar to make Gate logic explicit in UI.
                      Token flow on the left remains the ambient throughput simulation.
                    </div>
                  </div>

                  <!-- ADR preview -->
                  <div class="adr" aria-label="ADR preview">
                    <div class="adrTop">
                      <b>adr preview</b>
                      <div class="btnRow">
                        <button class="miniBtn" id="copyAdr" type="button">Copy JSON</button>
                        <button class="miniBtn" id="newCase" type="button">New Case</button>
                      </div>
                    </div>
                    <pre id="adrJson">{}</pre>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </aside>
      </div>
    </section>
  </div>

<!-- ✅ moved from inline <script> -->
<script defer src="../assets/part1-visualizer.js"></script>
</body>
</html>
