/* =========================================================
   Part I — Visualizer & HUD Styles
   Theme: "The Obsidian Terminal" (Military/Financial Grade)
   Scope: Styles the wrapper AND overrides internal viz styles
   ========================================================= */

/* 1. The Wrapper (Outer Frame) */
/* カードの丸み(radius)を排除し、鋭利なガラス板にする */
.visualizer-wrapper {
  width: 100%;
  margin: 5rem 0;
  border: 1px solid var(--border-sharp); /* site.cssの変数を参照 */
  border-radius: 0; /* Obsidian Style: No round corners */
  
  /* Deep Glass Texture */
  background: rgba(5, 5, 5, 0.7);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  
  overflow: hidden;
  position: relative;
  box-shadow: 0 20px 60px -20px rgba(0,0,0,0.6);
}

/* 走査線（Scanline）エフェクト: モニター越しに見ている演出 */
.visualizer-wrapper::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(to bottom, transparent 50%, rgba(0, 0, 0, 0.2) 50%);
  background-size: 100% 4px;
  pointer-events: none;
  z-index: 2;
  opacity: 0.25;
}

/* コンテンツ配置 */
.visualizer-wrapper .altrion-viz {
  width: 100%;
  position: relative;
  z-index: 3;
}

/* =========================================================
   VISUALIZER HUD INTERNALS
   Overriding JS styles with CSS Filters & Typography
   ========================================================= */

/* コンテナのリセット */
#visualizer-container,
.visualizer-box {
  background: transparent !important; /* ラッパー背景を使う */
  border: none !important;
  padding: 2.5rem;
  font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, monospace;
  color: var(--text-main);
}

/* Canvasの強制ホワイト化（Magic Filter） */
/* JSで描かれる「青い線」を、CSSフィルタで「発光する白」に変換 */
canvas#sim-canvas,
canvas.visualizer-graph {
  /* Grayscaleで色を抜き、Brightnessで輝度を上げ、Drop-shadowで発光させる */
  filter: grayscale(100%) brightness(300%) contrast(1.2) drop-shadow(0 0 4px var(--accent-glow));
  mix-blend-mode: screen; /* 背景に光として合成 */
  opacity: 0.95;
}

/* タイポグラフィ: 等幅フォント・タビュラー数字（桁ブレ防止） */
.stat-value,
.metric-value,
.gate-label,
#simulation-canvas {
  font-family: "JetBrains Mono", ui-monospace, monospace;
  font-variant-numeric: tabular-nums;
  letter-spacing: -0.03em;
}

/* 数値（Metrics）のレイアウト */
.metric-item {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  border-bottom: 1px solid var(--border-sharp);
  padding: 0.8rem 0;
  margin-bottom: 0.5rem;
}

.metric-label {
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.15em;
  color: var(--text-muted);
}

.metric-value {
  font-size: 1.1rem;
  font-weight: 500;
  color: #fff;
  text-shadow: 0 0 10px rgba(255,255,255,0.2);
}

/* ゲートインジケーター: 信号機から「ステータスパネル」へ */
.gate-indicator {
  display: inline-flex;
  align-items: center;
  padding: 0.4rem 0.8rem;
  background: rgba(255, 255, 255, 0.02);
  border: 1px solid rgba(255, 255, 255, 0.1);
  margin-right: 0.5rem;
  margin-bottom: 0.5rem;
  font-size: 0.75rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  transition: all 0.3s ease;
}

/* Active / Pass 状態: 白く発光 */
.gate-indicator.active,
.gate-indicator.pass {
  border-color: rgba(255,255,255,0.6);
  background: rgba(255, 255, 255, 0.08);
  color: #fff;
  box-shadow: 0 0 15px -4px var(--accent-glow);
}

/* Fail / Collapse 状態: 血の色（サイト唯一の有彩色） */
.gate-indicator.fail,
.gate-indicator.collapse {
  border-color: rgba(217, 4, 41, 0.5);
  background: rgba(217, 4, 41, 0.15);
  color: #ffcfcf;
  text-shadow: 0 0 8px rgba(217, 4, 41, 0.6);
  box-shadow: 0 0 20px -5px rgba(217, 4, 41, 0.3);
}

/* コントロール（スライダー）: ミニマルな矩形デザイン */
input[type="range"] {
  -webkit-appearance: none;
  background: transparent;
  width: 100%;
  margin: 1.5rem 0 1rem;
  cursor: ew-resize;
}
input[type="range"]:focus {
  outline: none;
}
input[type="range"]::-webkit-slider-runnable-track {
  background: var(--border-sharp);
  height: 1px;
  width: 100%;
}
input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  background: #fff;
  width: 4px; /* 丸ではなく、縦棒のつまみ */
  height: 16px;
  margin-top: -7px;
  border: none;
  box-shadow: 0 0 8px #fff;
  transition: transform 0.1s;
}
input[type="range"]::-webkit-slider-thumb:hover {
  transform: scaleY(1.2);
  background: #fff;
}
